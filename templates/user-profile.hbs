<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard</title>
    <link rel="stylesheet" href="home.css">
    <link rel="icon" href="favicon.png" type="image/jpg">
</head>
<body>
    <div class="min-h-screen flex bg-gradient-to-br" id="page-container">
        <div class="sidebar" id="sidebar">
            <div class="sidebar-title">Patient Dashboard</div>
            <ul class="menu-list">
                <li class="menu-item">Overview</li>
                <li class="menu-item">Doctors</li>
                <li class="menu-item">Medical History</li>
                <li class="menu-item">Tests & Analyzes</li>
                <li class="menu-item">Messages</li>
                <li class="menu-item">Departments</li>
            </ul>
            <div class="buttons-container">
                <button class="edit-button" onclick="window.location.href='http://localhost:3001/edit-profile'">Edit</button>
                <button class="logout-button" onclick="window.location.href='http://localhost:3001/login'">Logout</button>
            </div>
            <div class="dark-mode-toggle">
                <label for="dark-mode-switch">Dark Mode</label>
                <input type="checkbox" id="dark-mode-switch">
            </div>
        </div>

        <div class="main-content">
            <div class="profile-section">
                <div class="profile-card">
                    <img src="https://via.placeholder.com/100" alt="Profile" class="profile-img">
                    <h2 class="profile-name">Loading...</h2>
                    <p class="profile-id">Patient ID: Loading...</p>
                    <div class="profile-details">
                        <p>Age: <span id="age">Loading...</span></p>
                        <p>Blood Group: <span id="blood-group">Loading...</span></p>
                        <p>Height: <span id="height">Loading...</span></p>
                        <p>Weight: <span id="weight">Loading...</span></p>
                    </div>
                </div>
                <div class="stats-section">
                    <div class="stat-card">
                        <h3>General Health</h3>
                        <p id="general-health">Loading...</p>
                    </div>
                    <div class="stat-card">
                        <h3>Water Balance</h3>
                        <p id="water-balance">Loading...</p>
                    </div>
                </div>
            </div>
            <div class="activity-health">
                <div class="activity-card">
                    <h3>Your Activity</h3>
                    <p>Activity Graph Placeholder</p>
                </div>
                <div class="health-condition-card">
                    <h3>Your Health Conditions</h3>
                    <p>Health Condition Graph Placeholder</p>
                </div>
            </div>
            <div class="appointments-section">
                <h3>Doctor Appointments</h3>
                <div class="appointments-list">
                    <!-- Appointments can be added here -->
                </div>
            </div>
        </div>
    </div>

    <script>
       document.addEventListener("DOMContentLoaded", () => {
    const email = localStorage.getItem('userEmail'); // Retrieve email from local storage

    if (email) {
      fetch(`http://localhost:3001/api/user/${email}`)
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok ' + response.statusText);
          }
          return response.json();
        })
        .then(data => {
          document.querySelector(".profile-name").textContent = data.name || 'N/A';
          document.querySelector(".profile-id").textContent = `Patient ID: ${data.patientId || 'N/A'}`;
          document.getElementById("age").textContent = data.age || 'N/A';
          document.getElementById("blood-group").textContent = data.bloodGroup || 'N/A';
          document.getElementById("height").textContent = data.height + " cm" || 'N/A';
          document.getElementById("weight").textContent = data.weight + " kg" || 'N/A';
          document.getElementById("general-health").textContent = `${data.generalHealth || 'N/A'}%`;
          document.getElementById("water-balance").textContent = `${data.waterBalance || 'N/A'}%`;
        })
        .catch(error => console.error('Error fetching user data:', error));
    } else {
      console.error("No email found in local storage. Redirecting to login...");
      window.location.href = '/login';
    }
  

            const darkModeSwitch = document.getElementById('dark-mode-switch');
            const pageContainer = document.getElementById('page-container');

            if (localStorage.getItem('dark-mode') === 'enabled') {
                pageContainer.classList.add('dark-mode');
                darkModeSwitch.checked = true;
            }

            darkModeSwitch.addEventListener('change', () => {
                if (darkModeSwitch.checked) {
                    pageContainer.classList.add('dark-mode');
                    localStorage.setItem('dark-mode', 'enabled');
                } else {
                    pageContainer.classList.remove('dark-mode');
                    localStorage.setItem('dark-mode', 'disabled');
                }
            });
        });
    </script>
</body>
</html>
